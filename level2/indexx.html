<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Adamowo ‚Äì Przewodnik po Toksycznych Relacjach i Manipulacji</title>
    <meta name="description" content="Analizujemy rodzinnƒÖ historiƒô jako studium przypadku manipulacji, narcyzmu i toksycznych zachowa≈Ñ. Naucz siƒô rozpoznawaƒá czerwone flagi z Radiem Adamowo.">
    <meta name="keywords" content="Radio Adamowo, manipulacja, toksyczne relacje, narcyzm, przemoc psychiczna, gaslighting, studium przypadku, poradnik, czerwone flagi, pƒôtla przemocy">
    <meta name="csrf-token" content="">
    <meta name="theme-color" content="#000000">
    <link rel="icon" href="/images/icons/favicon.svg">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Special+Elite&display=swap" rel="stylesheet">
    
    <!-- Flatpickr Datepicker CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
    
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Draggable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MotionPathPlugin.min.js"></script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <style>
        :root {
            --color-primary: #f59e0b;   /* amber-500 */
            --color-secondary: #dc2626; /* red-600 */
            --color-background: #000000;
            --color-text: #e0e0e0;
        }
        body.modal-open { overflow: hidden; }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            background-image: 
                radial-gradient(ellipse at center, rgba(17,24,39,0.95) 0%, #000 70%);
            background-attachment: fixed;
        }
        .special-elite { font-family: 'Special Elite', cursive; }
        
        .playing-bar { animation: bounce 1.2s ease-in-out infinite; }
        @keyframes bounce { 0%, 100% { transform: scaleY(0.4); } 50% { transform: scaleY(1.0); } }
        
        .infinity-separator {
            width: 100px; height: 2px; margin: 4rem auto;
            background: linear-gradient(to right, transparent, var(--color-secondary), transparent);
            position: relative;
        }
        .infinity-separator::before {
            content: '‚àû'; font-size: 3rem; color: var(--color-secondary); opacity: 0.3;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        .modal-backdrop { animation: fadeIn 0.3s ease-out forwards; }
        .modal-content { animation: slideInUp 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(30px);} to { opacity: 1; transform: translateY(0);} }
        
        .tab-button { transition: all 0.3s ease; border-color: transparent; opacity: 0.6; }
        .tab-button.active {
            opacity: 1;
            transform: translateX(5px);
            border-color: var(--color-secondary);
            background-color: rgba(220, 38, 38, 0.1);
        }
        
        .witch-hut-container {
            background-color: #1a110a;
            background-image:
                radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.7) 100%),
                linear-gradient(to right, rgba(42,26,10,0.8), rgba(61,37,13,0.8) 50%, rgba(42,26,10,0.8));
            border: 2px solid #4a2a0a;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .avatar-group { will-change: transform; cursor: grab; }
        .avatar-group:active { cursor: grabbing; }
        .avatar { stroke-width: 2; filter: drop-shadow(0 0 8px currentColor); }
        #avatar-d circle { fill: var(--color-primary); stroke: #fde047; }
        #avatar-b circle { fill: var(--color-secondary); stroke: #fca5a5; }
        .avatar-label { font-family: 'Special Elite', cursive; font-size: 12px; fill: #FFFFFF; font-weight: 700; text-anchor: middle; pointer-events: none; }
        .fire-active circle { animation: pulse-fire 1s infinite alternate; }
        @keyframes pulse-fire {
            from { filter: drop-shadow(0 0 8px var(--color-secondary)); }
            to   { filter: drop-shadow(0 0 20px #ff6b6b); }
        }
    </style>
</head>
<body class="antialiased">
    <!-- MODAL KALENDARZA -->
    <div id="calendar-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" class="modal-backdrop hidden fixed inset-0 bg-black/80 flex items-center justify-center z-[100] p-4">
        <div class="modal-content w-full max-w-lg bg-gray-900 border border-amber-500 rounded-lg shadow-xl p-6 relative">
            <h3 id="modal-title" class="text-2xl font-bold special-elite text-amber-400 mb-4">Notatki z dnia: <span id="modal-date"></span></h3>
            <div id="modal-notes-display" class="space-y-3 mb-4 max-h-48 overflow-y-auto pr-2"></div>
            <div id="modal-pagination" class="flex justify-between items-center mt-4 hidden">
                <button id="prev-page-btn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed">Poprzednia</button>
                <span id="page-info" class="text-gray-400"></span>
                <button id="next-page-btn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed">Nastƒôpna</button>
            </div>
            <form id="modal-note-form" class="mt-4">
                <input type="text" id="modal-name-input" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 mb-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="Twoje imiƒô lub pseudonim" required maxlength="50">
                <textarea id="modal-note-input" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-amber-500" rows="3" placeholder="Dodaj nowƒÖ czerwonƒÖ flagƒô..." required maxlength="1000"></textarea>
                <div id="modal-feedback" class="text-sm mt-2 min-h-[1.25rem]"></div>
                <div class="flex justify-end items-center mt-4 space-x-3">
                    <button type="button" id="modal-close-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition">Zamknij</button>
                    <button type="submit" class="px-4 py-2 bg-red-700 hover:bg-red-800 text-white font-semibold rounded-md transition">Zapisz Notatkƒô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NAK≈ÅADKA AUTOPLAY -->
    <div id="autoplay-overlay" class="fixed inset-0 bg-black/95 flex flex-col items-center justify-center z-[99] text-center p-4">
        <h2 class="text-4xl font-bold special-elite text-amber-500 mb-4">Radio Adamowo</h2>
        <p class="text-lg text-gray-300 mb-8">Ze wzglƒôdu na ograniczenia przeglƒÖdarki, rozpocznij transmisjƒô rƒôcznie.</p>
        <button id="start-btn" class="bg-red-800 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-lg text-xl transition transform hover:scale-105">Uruchom Transmisjƒô</button>
    </div>

    <!-- NAG≈Å√ìWEK I NAWIGACJA -->
    <header class="bg-black/80 backdrop-blur-sm sticky top-0 z-50 shadow-lg shadow-red-900/20">
        <nav class="container mx-auto px-4" aria-label="G≈Ç√≥wna nawigacja">
            <div class="flex justify-between items-center py-3">
                <a href="#" class="text-2xl font-bold special-elite text-amber-500">üéôÔ∏è Radio Adamowo</a>
                <ul class="hidden md:flex items-center space-x-6">
                    <li><a href="#kalendarium" class="text-gray-300 hover:text-amber-400 transition">Pƒôtla Przemocy</a></li>
                    <li><a href="#audycje" class="text-gray-300 hover:text-amber-400 transition">Audycje</a></li>
                    <li><a href="#poradnik" class="text-gray-300 hover:text-amber-400 transition">Poradnik</a></li>
                    <li><a href="#interaktywne" class="text-gray-300 hover:text-amber-400 transition">Strefa Interaktywna</a></li>
                </ul>
                 <button id="menu-toggle" class="md:hidden text-gray-300 hover:text-white focus:outline-none" aria-label="Otw√≥rz menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                </button>
            </div>
             <ul id="mobile-menu" class="md:hidden absolute top-full left-0 w-full bg-black/90 text-center text-gray-300 hidden flex-col space-y-2 py-4 shadow-lg">
                <li><a href="#kalendarium" class="block hover:text-amber-400 py-2">Pƒôtla Przemocy</a></li>
                <li><a href="#audycje" class="block hover:text-amber-400 py-2">Audycje</a></li>
                <li><a href="#poradnik" class="block hover:text-amber-400 py-2">Poradnik</a></li>
                <li><a href="#interaktywne" class="block hover:text-amber-400 py-2">Strefa Interaktywna</a></li>
            </ul>
        </nav>
    </header>

    <main role="main" class="container mx-auto p-4 md:p-8 max-w-5xl">
        <!-- ODTWARZACZ RADIA -->
        <section id="live-player" class="mb-16 bg-gray-900/70 p-6 rounded-lg border-2 border-red-900/50 shadow-lg text-center" aria-labelledby="live-player-title">
            <h2 id="live-player-title" class="text-2xl font-bold mb-4 special-elite flex items-center justify-center">
                <span class="relative flex h-3 w-3 mr-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span></span>
                Radio Adamowo: Muzyka z Eteru
            </h2>
            <audio id="radio-player" preload="auto" crossorigin="anonymous" class="hidden"></audio>
            <div id="playlist-selector" class="flex justify-center flex-wrap gap-3 my-4">
                <button data-playlist="ambient" class="playlist-btn bg-amber-800 hover:bg-amber-700 text-white font-semibold py-2 px-4 rounded transition">Ambient</button>
                <button data-playlist="disco" class="playlist-btn bg-pink-600 hover:bg-pink-500 text-white font-semibold py-2 px-4 rounded transition">Disco Fever</button>
                <button data-playlist="hiphop" class="playlist-btn bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded transition">Hip-Hop Flow</button>
                <button data-playlist="kids" class="playlist-btn bg-green-600 hover:bg-green-500 text-white font-semibold py-2 px-4 rounded transition">Kids Beats</button>
            </div>
            <div class="flex items-center justify-center space-x-4 my-4">
                <p id="radio-current-song" class="text-lg text-amber-300 font-semibold truncate">Wybierz styl i naci≈õnij play...</p>
            </div>
            <div class="flex justify-center items-center space-x-6">
                <button id="radio-prev-btn" aria-label="Poprzedni utw√≥r" class="text-gray-400 hover:text-white transition"><svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M8.445 14.832A1 1 0 0010 14.03V5.97a1 1 0 00-1.555-.832L4.22 9.168a1 1 0 000 1.664l4.225 4.001zM15.555 14.832a1 1 0 001.555-.832V5.97a1 1 0 00-1.555-.832L11.22 9.168a1 1 0 000 1.664l4.225 4.001z"></path></svg></button>
                <button id="radio-play-pause-btn" aria-label="Odtwarzaj" class="bg-red-800 hover:bg-red-700 text-white rounded-full p-4 transition">
                    <svg id="radio-play-icon" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"></path></svg>
                    <svg id="radio-pause-icon" class="w-8 h-8 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M5.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75A.75.75 0 007.25 3h-1.5zm7 0a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75h-1.5z"></path></svg>
                </button>
                 <button id="radio-next-btn" aria-label="Nastƒôpny utw√≥r" class="text-gray-400 hover:text-white transition"><svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M4.445 5.168A1 1 0 003 5.97v8.06a1 1 0 001.555.832L8.78 10.832a1 1 0 000-1.664L4.445 5.168zM11.555 5.168A1 1 0 0010 5.97v8.06a1 1 0 001.555.832l4.225-4.001a1 1 0 000-1.664l-4.225-4.001z"></path></svg></button>
            </div>
        </section>
        
        <div class="infinity-separator"></div>

        <!-- PƒòTLA PRZEMOCY -->
        <section id="kalendarium" class="mb-16" aria-labelledby="kalendarium-title">
            <h2 id="kalendarium-title" class="text-3xl font-bold mb-8 border-l-4 border-red-800 pl-4 special-elite">Kocio≈Ç Wied≈∫my: Pƒôtla Przemocy</h2>
            <div class="witch-hut-container p-6 rounded-lg text-center">
                 <div class="relative w-full max-w-lg mx-auto aspect-video">
                    <svg viewBox="0 0 200 100" class="w-full h-full overflow-visible">
                         <path id="infinity-path" d="M50,50 C50,0 150,100 150,50 C150,0 50,100 50,50 Z" class="stroke-[3] fill-none stroke-red-600/70" />
                         <g id="avatar-d" class="avatar-group"><circle class="avatar" r="12"></circle><text class="avatar-label" dy=".3em">D</text></g>
                         <g id="avatar-b" class="avatar-group"><circle class="avatar" r="12"></circle><text class="avatar-label" dy=".3em">B</text></g>
                    </svg>
                </div>
                <div id="timeline-description" class="mt-4 text-amber-300 italic min-h-[3em]">PrzeciƒÖgnij kule energii, by poczuƒá napiƒôcie...</div>
            </div>
        </section>
        
        <div class="infinity-separator"></div>

        <!-- AUDYCJE ANALITYCZNE -->
        <section id="audycje" class="mb-16" aria-labelledby="audycje-title">
            <h2 id="audycje-title" class="text-3xl font-bold mb-6 border-l-4 border-amber-500 pl-4 special-elite">Audycje Analityczne: Studium Manipulacji</h2>
             <div id="podcast-player-container" class="my-12 sticky top-24 z-40">
                 <div class="bg-gray-800/90 backdrop-blur-sm p-4 rounded-lg border border-amber-500 shadow-lg">
                    <h3 class="text-xl font-bold special-elite text-amber-400 mb-3 text-center">Odtwarzacz Analiz</h3>
                    <p id="podcast-title" class="text-center text-gray-300 mb-4 min-h-[1.5em]">Wybierz audycjƒô z listy</p>
                    <audio id="podcast-player" controls crossorigin="anonymous" class="w-full">
                         Twoja przeglƒÖdarka nie obs≈Çuguje tego elementu audio.
                    </audio>
                </div>
            </div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                 <button class="podcast-play-button text-left bg-gray-900 p-4 rounded-lg border border-gray-700 hover:border-amber-400 transition" data-track-id="sprawaAdamskich"><h4 class="font-bold text-amber-400">Sprawa Adamskich: Wprowadzenie</h4><p class="text-sm text-gray-400">Zarys historii, kt√≥ra sta≈Ça siƒô naszym studium przypadku.</p></button>
                <button class="podcast-play-button text-left bg-gray-900 p-4 rounded-lg border border-gray-700 hover:border-amber-400 transition" data-track-id="niewdziecznosc"><h4 class="font-bold text-amber-400">"Ra≈ºƒÖca Niewdziƒôczno≈õƒá": Bro≈Ñ Narcyza</h4><p class="text-sm text-gray-400">Jak termin prawny staje siƒô narzƒôdziem gaslightingu.</p></button>
                <button class="podcast-play-button text-left bg-gray-900 p-4 rounded-lg border border-gray-700 hover:border-amber-400 transition" data-track-id="kalendarzAnaliza"><h4 class="font-bold text-amber-400">Analiza Kalendarza: Kronika Eskalacji</h4><p class="text-sm text-gray-400">≈öledzimy, jak drobne incydenty budujƒÖ mur przemocy.</p></button>
                <button class="podcast-play-button text-left bg-gray-900 p-4 rounded-lg border border-gray-700 hover:border-amber-400 transition" data-track-id="sledztwo"><h4 class="font-bold text-amber-400">≈öledztwo: Jak Dokumentowaƒá Manipulacjƒô?</h4><p class="text-sm text-gray-400">Praktyczny poradnik, jak zbieraƒá dowody i chroniƒá siƒô.</p></button>
            </div>
        </section>
        
        <div class="infinity-separator"></div>

        <!-- PORADNIK W ZAK≈ÅADKACH -->
        <section id="poradnik" class="my-16" aria-labelledby="poradnik-title">
            <h2 id="poradnik-title" class="text-3xl font-bold mb-6 border-l-4 border-amber-500 pl-4 special-elite">Poradnik: 8 Grzech√≥w Toksycznych Os√≥b</h2>
            <div class="flex flex-col md:flex-row gap-8">
                <div id="tab-buttons" class="flex md:flex-col md:w-1/4 flex-row flex-wrap justify-center gap-2">
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech1">1. PieniƒÖdze</button>
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech2">2. Wina</button>
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech3">3. Gaslighting</button>
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech4">4. Kontrola</button>
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech5">5. Instytucje</button>
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech6">6. Szanta≈º</button>
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech7">7. Chaos</button>
                    <button class="tab-button text-left p-3 border-l-4 w-full" data-tab="grzech8">8. Podzia≈Çy</button>
                </div>
                <div id="tab-contents" class="md:w-3/4">
                    <article id="grzech1" class="tab-content bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 1: Branie pieniƒôdzy zamiast pomocy</h3><p><strong>Opis:</strong> Toksyczna osoba stara siƒô o ≈õwiadczenia, ale faktycznie nie zajmuje siƒô podopiecznym, wykorzystuje ≈õrodki na w≈Çasne cele.</p></article>
                    <article id="grzech2" class="tab-content hidden bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 2: Przerzucanie winy i granie ofiary</h3><p><strong>Opis:</strong> Manipulant nigdy nie przyzna siƒô do b≈Çƒôdu ‚Äì nawet je≈õli zostanie przy≈Çapany, natychmiast znajduje winnego ‚Äûna zewnƒÖtrz‚Äù.</p></article>
                    <article id="grzech3" class="tab-content hidden bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 3: Gaslighting</h3><p><strong>Opis:</strong> Podwa≈ºanie Twojej percepcji i uczuƒá. Manipulant powtarza, ≈ºe przesadzasz, by os≈Çabiƒá TwojƒÖ pewno≈õƒá siebie.</p></article>
                    <article id="grzech4" class="tab-content hidden bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 4: Inwigilacja i obsesyjna kontrola</h3><p><strong>Opis:</strong> Toksyczna osoba notuje ka≈ºdy Tw√≥j ruch, zbiera ‚Äûdowody‚Äù ‚Äì nawet absurdalne ‚Äì i u≈ºywa ich do szanta≈ºu.</p></article>
                    <article id="grzech5" class="tab-content hidden bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 5: U≈ºywanie instytucji jako broni</h3><p><strong>Opis:</strong> Policja, sƒÖdy, urzƒôdy sƒÖ wciƒÖgane do gry rodzinnej, by zastraszyƒá lub wymusiƒá pos≈Çusze≈Ñstwo.</p></article>
                    <article id="grzech6" class="tab-content hidden bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 6: Szanta≈º emocjonalny</h3><p><strong>Opis:</strong> Manipulant grozi odebraniem domu, cofniƒôciem darowizny, je≈õli nie podporzƒÖdkujesz siƒô jego woli.</p></article>
                    <article id="grzech7" class="tab-content hidden bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 7: Tworzenie chaosu</h3><p><strong>Opis:</strong> Manipulant zmienia wersje wydarze≈Ñ, wprowadza sprzeczne informacje, sieje zamƒôt, by ukryƒá prawdƒô.</p></article>
                    <article id="grzech8" class="tab-content hidden bg-gray-900/50 p-6 rounded-lg"><h3 class="text-2xl font-semibold mb-3 text-red-300 special-elite">Grzech 8: Sianie podzia≈Ç√≥w</h3><p><strong>Opis:</strong> Toksyczna osoba celowo nastawia cz≈Çonk√≥w rodziny przeciwko sobie, szuka ‚Äûsojusznik√≥w‚Äù, buduje uk≈Çady ‚Äûmy kontra oni‚Äù.</p></article>
                </div>
            </div>
        </section>

        <div class="infinity-separator"></div>

        <!-- STREFA INTERAKTYWNA -->
        <section id="interaktywne" class="mb-16" aria-labelledby="interaktywne-title">
            <h2 id="interaktywne-title" class="text-3xl font-bold mb-6 border-l-4 border-red-800 pl-4 special-elite">Strefa Interaktywna</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <article aria-labelledby="dziennik-title" class="bg-gray-900 p-6 rounded-lg">
                    <h3 id="dziennik-title" class="text-xl font-bold mb-4">Dziennik Czerwonych Flag</h3>
                    <p class="text-sm text-gray-400 mb-4">Kliknij datƒô, aby dodaƒá lub zobaczyƒá anonimowe zapiski spo≈Çeczno≈õci.</p>
                    <div id="calendar-container">
                        <input type="text" id="calendar-input" class="bg-gray-800 text-white p-2 rounded w-full" placeholder="Wybierz datƒô...">
                    </div>
                </article>
                 <article class="bg-gray-900 p-6 rounded-lg" aria-labelledby="chat-title">
                    <h3 id="chat-title" class="text-xl font-bold mb-3">Symulator Rozmowy z Manipulatorem (AI)</h3>
                    <p class="text-sm text-gray-400 mb-4 italic">Przetestuj swoje reakcje. Czy rozpoznasz techniki AI?</p>
                    <div id="chat-container" class="bg-gray-800 rounded-lg p-4 mb-4 space-y-2 max-h-60 overflow-y-auto text-sm" aria-live="polite">
                        <div class="text-left">
                            <span class="inline-block bg-gray-700 text-gray-200 px-3 py-2 rounded-lg"><strong>Manipulator (AI):</strong> Czekam...</span>
                        </div>
                    </div>
                    <form id="chat-form" class="flex">
                        <input type="text" id="chat-input" class="flex-1 bg-gray-700 text-white placeholder-gray-400 rounded-l-md p-2 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="Napisz wiadomo≈õƒá..." required />
                        <button type="submit" class="bg-amber-500 text-black font-bold px-4 py-2 rounded-r-md hover:bg-amber-600 transition">Odpowiedz</button>
                    </form>
                </article>
                 <article aria-labelledby="therapist-title" class="bg-gray-900 p-6 rounded-lg md:col-span-2">
                    <h3 id="therapist-title" class="text-xl font-bold mb-3">Zapytaj AI Psychologa</h3>
                    <p class="text-sm text-gray-400 mb-4 italic">Masz pytanie lub potrzebujesz wsparcia? Napisz, a wirtualny psycholog postara siƒô pom√≥c.</p>
                    <div id="therapist-container" class="bg-gray-800 rounded-lg p-4 mb-4 space-y-2 max-h-60 overflow-y-auto text-sm" aria-live="polite"></div>
                    <form id="therapist-form" class="flex">
                        <input type="text" id="therapist-input" class="flex-1 bg-gray-700 text-white placeholder-gray-400 rounded-l-md p-2 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="Napisz wiadomo≈õƒá do AI..." required>
                        <button type="submit" class="bg-amber-500 text-black font-bold px-4 py-2 rounded-r-md hover:bg-amber-600 transition">Wy≈õlij</button>
                    </form>
                    <p class="text-xs text-gray-500 mt-2 italic">Uwaga: odpowiedzi AI majƒÖ charakter poglƒÖdowy i nie zastƒÖpiƒÖ profesjonalnej pomocy.</p>
                </article>
            </div>
        </section>
    </main>
    
    <footer class="bg-gray-900 border-t border-gray-800 py-8">
        <div class="container mx-auto text-center text-gray-500 px-4">
            <p>&copy; <span id="current-year"></span> Radio Adamowo. Wszelkie prawa zastrze≈ºone.</p>
        </div>
    </footer>
    
    <button id="to-top-button" class="hidden fixed bottom-5 right-5 bg-red-800/80 text-white p-3 rounded-full shadow-lg hover:bg-red-700 transition" aria-label="Wr√≥ƒá na g√≥rƒô strony">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
    </button>
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pl.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const doc = document;
            let csrfToken = '';

            // --- INICJALIZACJA ---
            async function initializeApp() {
                await fetchCsrfToken();
                setupEventListeners();
                initRadioPlayer();
                initPodcastPlayer();
                initTabs();
                initInfinityTimeline();
                initCalendar();
                initAIChat();
                initAITheparist();
                initUI();
            }

            // --- BEZPIECZE≈ÉSTWO ---
            async function fetchCsrfToken() {
                try {
                    const response = await fetch('./get_csrf_token.php');
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    csrfToken = data.csrf_token;
                    doc.querySelector('meta[name="csrf-token"]').setAttribute('content', csrfToken);
                } catch (error) {
                    console.error('Nie uda≈Ço siƒô pobraƒá tokena CSRF:', error);
                    const feedbackEl = doc.getElementById('modal-feedback');
                    if (feedbackEl) feedbackEl.textContent = 'B≈ÇƒÖd bezpiecze≈Ñstwa. Od≈õwie≈º stronƒô.';
                }
            }
            
            // --- ODTWARZACZE ---
            const radioPlayer = doc.getElementById('radio-player');
            const podcastPlayer = doc.getElementById('podcast-player');
            const playlists = {
                ambient: Array.from({ length: 304 }, (_, i) => ({ title: `Utw√≥r ambientowy #${i + 1}`, file: `music/Utwor (${i + 1}).mp3` })),
                disco: [{ title: 'Disco Fever #1', file: 'music/disco/track1.mp3' }],
                hiphop: [{ title: 'Hip-Hop Flow #1', file: 'music/hiphop/track1.mp3' }],
                kids: [{ title: 'Kids Beats #1', file: 'music/kids/track1.mp3' }],
                podcasts: [
                    { id: 'sprawaAdamskich', title: "Sprawa Adamskich: Wprowadzenie", file: 'audio/Adamskich_Sprawa.mp3' },
                    { id: 'niewdziecznosc', title: "'Ra≈ºƒÖca Niewdziƒôczno≈õƒá': Bro≈Ñ Narcyza", file: 'audio/Ra≈ºƒÖca_Niewdziƒôczno≈õƒá.mp3' },
                    { id: 'kalendarzAnaliza', title: "Analiza Kalendarza: Kronika Eskalacji", file: 'audio/kalendarz_analiza.mp3' },
                    { id: 'sledztwo', title: "≈öledztwo: Jak Dokumentowaƒá Manipulacjƒô?", file: 'audio/sledztwo.mp3' },
                ]
            };
            let currentRadioPlaylist = [];
            let currentRadioIndex = 0;

            function initRadioPlayer() {
                const playPauseBtn = doc.getElementById('radio-play-pause-btn');
                const nextBtn = doc.getElementById('radio-next-btn');
                const prevBtn = doc.getElementById('radio-prev-btn');
                
                doc.querySelectorAll('.playlist-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        radioPlayer.pause();
                        setRadioPlaylist(button.dataset.playlist);
                    });
                });

                playPauseBtn.addEventListener('click', toggleRadioPlay);
                nextBtn.addEventListener('click', () => playRadioTrack(currentRadioIndex + 1));
                prevBtn.addEventListener('click', () => playRadioTrack(currentRadioIndex - 1));
                radioPlayer.addEventListener('ended', () => playRadioTrack(currentRadioIndex + 1));
                radioPlayer.addEventListener('play', updateRadioUI);
                radioPlayer.addEventListener('pause', updateRadioUI);
                setRadioPlaylist('ambient');
            }
            
            function setRadioPlaylist(key) {
                currentRadioPlaylist = [...(playlists[key] || [])];
                shuffleArray(currentRadioPlaylist);
                currentRadioIndex = 0;
                doc.getElementById('radio-current-song').textContent = `Wybrano: ${key}. Naci≈õnij play.`;
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function toggleRadioPlay() {
                if (radioPlayer.paused) {
                    playRadioTrack(currentRadioIndex);
                } else {
                    radioPlayer.pause();
                }
            }

            function playRadioTrack(index) {
                if (!currentRadioPlaylist.length) return;
                currentRadioIndex = (index + currentRadioPlaylist.length) % currentRadioPlaylist.length;
                const track = currentRadioPlaylist[currentRadioIndex];
                if (track) {
                    podcastPlayer.pause();
                    radioPlayer.src = track.file;
                    doc.getElementById('radio-current-song').textContent = track.title;
                    radioPlayer.play().catch(e => console.error("B≈ÇƒÖd odtwarzania radia:", e));
                }
            }
            
            function updateRadioUI() {
                const isPlaying = !radioPlayer.paused;
                doc.getElementById('radio-play-icon').classList.toggle('hidden', isPlaying);
                doc.getElementById('radio-pause-icon').classList.toggle('hidden', !isPlaying);
            }

            function initPodcastPlayer() {
                 doc.querySelectorAll('.podcast-play-button').forEach(button => {
                    button.addEventListener('click', () => {
                        const track = playlists.podcasts.find(t => t.id === button.dataset.trackId);
                        if (track) {
                            radioPlayer.pause();
                            podcastPlayer.src = track.file;
                            doc.getElementById('podcast-title').textContent = track.title;
                            podcastPlayer.play().catch(e => console.error("B≈ÇƒÖd odtwarzania podcastu:", e));
                        }
                    });
                });
            }

            // --- ZAK≈ÅADKI ---
            function initTabs() {
                const tabButtons = doc.querySelectorAll('.tab-button');
                const tabContents = doc.querySelectorAll('.tab-content');
                
                function switchTab(targetTabId) {
                    tabContents.forEach(content => content.classList.toggle('hidden', content.id !== targetTabId));
                    tabButtons.forEach(button => button.classList.toggle('active', button.dataset.tab === targetTabId));
                }

                tabButtons.forEach(button => button.addEventListener('click', () => switchTab(button.dataset.tab)));
                if(tabButtons.length > 0) switchTab(tabButtons[0].dataset.tab);
            }

            // --- PƒòTLA PRZEMOCY (GSAP) ---
            function initInfinityTimeline() {
                gsap.registerPlugin(Draggable, MotionPathPlugin);
                const path = doc.getElementById('infinity-path');
                const avatarD = doc.getElementById('avatar-d');
                const avatarB = doc.getElementById('avatar-b');
                const description = doc.getElementById('timeline-description');
                const stages = [
                    { range: [0, 0.25], text: "PoczƒÖtek dewaluacji: pojawiajƒÖ siƒô pierwsze drobne uszczypliwo≈õci." },
                    { range: [0.25, 0.5], text: "Eskalacja: otwarty konflikt i gaslighting." },
                    { range: [0.5, 0.75], text: "Faza odrzucenia: manipulator karze ofiarƒô ciszƒÖ." },
                    { range: [0.75, 1.0], text: "Powr√≥t do idealizacji (hoovering): obietnice poprawy." }
                ];

                function updateTimelineState(progress) {
                    progress = (progress + 1) % 1;
                    gsap.set(avatarD, { motionPath: { path: path, align: path, alignOrigin: [0.5, 0.5], end: progress } });
                    gsap.set(avatarB, { motionPath: { path: path, align: path, alignOrigin: [0.5, 0.5], end: (progress + 0.5) % 1 } });
                    const currentStage = stages.find(s => progress >= s.range[0] && progress < s.range[1]) || stages[0];
                    if (description) description.textContent = currentStage.text;
                    const manipulatorProgress = (progress + 0.5) % 1;
                    avatarB.classList.toggle('fire-active', manipulatorProgress > 0.25 && manipulatorProgress < 0.75);
                }

                Draggable.create([avatarD, avatarB], { 
                    type:"motionPath", 
                    motionPath: { path: path, align: path }, 
                    onDrag: function() { 
                        let progress = (this.target === avatarB) ? this.progress - 0.5 : this.progress; 
                        updateTimelineState(progress); 
                    } 
                });
                updateTimelineState(0);
            }

            // --- DZIENNIK CZERWONYCH FLAG (KALENDARZ I MODAL) ---
            let currentSelectedDate = null;
            let currentPage = 1;
            let totalPages = 1;

            function initCalendar() {
                const calendarInput = doc.getElementById('calendar-input');
                flatpickr(calendarInput, {
                    locale: "pl", inline: true, dateFormat: "Y-m-d",
                    onChange: (selectedDates, dateStr) => {
                        currentSelectedDate = dateStr;
                        doc.getElementById('modal-date').textContent = selectedDates[0].toLocaleDateString('pl-PL');
                        fetchNotesForDate(dateStr, 1);
                        openModal();
                    }
                });
            }

            async function fetchNotesForDate(date, page = 1) {
                const notesDisplay = doc.getElementById('modal-notes-display');
                notesDisplay.innerHTML = '<p class="text-gray-400">Wczytywanie...</p>';
                try {
                    const response = await fetch(`./get_comments.php?date=${date}&page=${page}&limit=3`);
                    if (!response.ok) throw new Error(`B≈ÇƒÖd serwera: ${response.statusText}`);
                    const result = await response.json();
                    if (result.status !== 'success') throw new Error(result.message);
                    
                    const { data: notes, pagination } = result;
                    currentPage = pagination.currentPage;
                    totalPages = pagination.totalPages;
                    renderNotes(notes);
                    updatePagination();
                } catch (error) {
                    console.error('B≈ÇƒÖd pobierania notatek:', error);
                    notesDisplay.innerHTML = `<p class="text-red-500">Nie uda≈Ço siƒô za≈Çadowaƒá notatek.</p>`;
                }
            }

            function renderNotes(notes) {
                const notesDisplay = doc.getElementById('modal-notes-display');
                notesDisplay.innerHTML = '';
                if (notes.length > 0) {
                    notes.forEach(note => {
                        const noteEl = doc.createElement('div');
                        noteEl.className = 'bg-gray-800 p-2 rounded';
                        noteEl.innerHTML = `<strong class="text-amber-400">${note.name}:</strong><p class="text-gray-300 whitespace-pre-wrap">${note.text}</p><small class="text-gray-500">${note.created_at}</small>`;
                        notesDisplay.appendChild(noteEl);
                    });
                } else {
                    notesDisplay.innerHTML = '<p class="text-gray-500 italic">Brak notatek dla tego dnia.</p>';
                }
            }

            function updatePagination() {
                const paginationEl = doc.getElementById('modal-pagination');
                const pageInfo = doc.getElementById('page-info');
                const prevBtn = doc.getElementById('prev-page-btn');
                const nextBtn = doc.getElementById('next-page-btn');

                if (totalPages > 1) {
                    paginationEl.classList.remove('hidden');
                    pageInfo.textContent = `Strona ${currentPage} z ${totalPages}`;
                    prevBtn.disabled = currentPage <= 1;
                    nextBtn.disabled = currentPage >= totalPages;
                } else {
                    paginationEl.classList.add('hidden');
                }
            }

            function openModal() {
                doc.getElementById('calendar-modal').classList.remove('hidden');
                doc.body.classList.add('modal-open');
            }

            function closeModal() {
                doc.getElementById('calendar-modal').classList.add('hidden');
                doc.body.classList.remove('modal-open');
            }

            // --- SYMULATORY AI ---
            function initAIChat() {
                const chatForm = doc.getElementById('chat-form');
                chatForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const input = doc.getElementById('chat-input');
                    const container = doc.getElementById('chat-container');
                    const msg = input.value.trim();
                    if (!msg) return;

                    appendMessage(container, `Ty: ${msg}`, 'user');
                    input.value = '';

                    setTimeout(() => {
                        const responses = ["Przesadzasz.", "Nigdy czego≈õ takiego nie powiedzia≈Çem.", "Robiƒô to dla twojego dobra.", "Gdyby≈õ tylko bardziej siƒô stara≈Ç...", "Wszyscy my≈õlƒÖ, ≈ºe zwariowa≈Çe≈õ."];
                        const response = responses[Math.floor(Math.random() * responses.length)];
                        appendMessage(container, `Manipulator (AI): ${response}`, 'ai');
                    }, 1000);
                });
            }
            
            function initAITheparist() {
                const therapistForm = doc.getElementById('therapist-form');
                therapistForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const input = doc.getElementById('therapist-input');
                    const container = doc.getElementById('therapist-container');
                    const msg = input.value.trim();
                    if (!msg) return;
                    
                    appendMessage(container, `Ty: ${msg}`, 'user');
                    input.value = '';

                    setTimeout(() => {
                        const responses = [
                            "Rozumiem, ≈ºe tak siƒô czujesz. To bardzo trudne do≈õwiadczenie.",
                            "Nie jeste≈õ z tym sam/sama. Wiele os√≥b prze≈ºywa podobne sytuacje.",
                            "Twoje emocje sƒÖ wa≈ºne i masz prawo je odczuwaƒá.",
                            "To, co opisujesz, brzmi jak toksyczne zachowanie. Pamiƒôtaj, by dbaƒá o swoje granice."
                        ];
                        const response = responses[Math.floor(Math.random() * responses.length)];
                        appendMessage(container, `AI Psycholog: ${response}`, 'ai');
                    }, 1500);
                });
            }

            function appendMessage(container, text, sender) {
                const msgEl = doc.createElement('div');
                msgEl.className = sender === 'user' ? 'text-right' : 'text-left';
                const span = doc.createElement('span');
                span.className = `inline-block px-3 py-2 rounded-lg ${sender === 'user' ? 'bg-amber-500 text-black' : 'bg-gray-700 text-gray-200'}`;
                span.textContent = text;
                msgEl.appendChild(span);
                container.appendChild(msgEl);
                container.scrollTop = container.scrollHeight;
            }

            // --- INTERFEJS U≈ªYTKOWNIKA I EVENT LISTENERS ---
            function initUI() {
                doc.getElementById('current-year').textContent = new Date().getFullYear();
                const toTopButton = doc.getElementById('to-top-button');
                window.addEventListener('scroll', () => toTopButton.classList.toggle('hidden', window.scrollY <= 300));
                toTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

                const menuToggle = doc.getElementById('menu-toggle');
                const mobileMenu = doc.getElementById('mobile-menu');
                menuToggle.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
                mobileMenu.querySelectorAll('a').forEach(link => link.addEventListener('click', () => mobileMenu.classList.add('hidden')));
            }

            function setupEventListeners() {
                doc.getElementById('start-btn').addEventListener('click', () => doc.getElementById('autoplay-overlay').classList.add('hidden'));
                doc.getElementById('modal-close-btn').addEventListener('click', closeModal);
                doc.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

                doc.getElementById('prev-page-btn').addEventListener('click', () => { if (currentPage > 1) fetchNotesForDate(currentSelectedDate, currentPage - 1); });
                doc.getElementById('next-page-btn').addEventListener('click', () => { if (currentPage < totalPages) fetchNotesForDate(currentSelectedDate, currentPage + 1); });
            
                const modalNoteForm = doc.getElementById('modal-note-form');
                modalNoteForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!csrfToken) {
                        doc.getElementById('modal-feedback').textContent = 'B≈ÇƒÖd bezpiecze≈Ñstwa. Od≈õwie≈º stronƒô.';
                        return;
                    }
                    const name = doc.getElementById('modal-name-input').value.trim();
                    const text = doc.getElementById('modal-note-input').value.trim();
                    if (!name || !text || !currentSelectedDate) return;

                    try {
                        const response = await fetch('./add_comment.php', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ date: currentSelectedDate, name, text, csrf_token: csrfToken })
                        });
                        const result = await response.json();
                        if (!response.ok || result.status !== 'success') throw new Error(result.message || 'Nieznany b≈ÇƒÖd');
                        
                        modalNoteForm.reset();
                        doc.getElementById('modal-feedback').textContent = 'Dodano notatkƒô!';
                        fetchNotesForDate(currentSelectedDate, 1);
                        await fetchCsrfToken();
                    } catch (error) {
                        doc.getElementById('modal-feedback').textContent = `B≈ÇƒÖd: ${error.message}`;
                    }
                });
            }
            
            initializeApp();
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('SW registered: ', registration);
                }).catch(registrationError => {
                    console.log('SW registration failed: ', registrationError);
                });
            });
        }
    </script>
</body>
</html>

